/**
 * vis-data
 * http://visjs.org/
 *
 * Manage unstructured data using DataSet. Add, update, and remove data, and listen for changes in the data.
 *
 * @version 7.1.0
 * @date    2020-10-13T20:44:00.711Z
 *
 * @copyright (c) 2011-2017 Almende B.V, http://almende.com
 * @copyright (c) 2017-2019 visjs contributors, https://github.com/visjs
 *
 * @license
 * vis.js is dual licensed under both
 *
 *   1. The Apache 2.0 License
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *   and
 *
 *   2. The MIT License
 *      http://opensource.org/licenses/MIT
 *
 * vis.js may be distributed under either license.
 */
import{pureDeepObjectAssign as t}from"vis-util/esnext/esm/vis-util.js";export{DELETE}from"vis-util/esnext/esm/vis-util.js";import{v4 as e}from"uuid";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function s(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function i(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s}var r,n,o,h,l,a,u,f,d,c,p,g,m,y;function _(t){return new v(t)}class w{constructor(t,e,s){this._source=t,this._transformers=e,this._target=s,this._listeners={add:this._add.bind(this),remove:this._remove.bind(this),update:this._update.bind(this)}}all(){return this._target.update(this._transformItems(this._source.get())),this}start(){return this._source.on("add",this._listeners.add),this._source.on("remove",this._listeners.remove),this._source.on("update",this._listeners.update),this}stop(){return this._source.off("add",this._listeners.add),this._source.off("remove",this._listeners.remove),this._source.off("update",this._listeners.update),this}_transformItems(t){return this._transformers.reduce(((t,e)=>e(t)),t)}_add(t,e){null!=e&&this._target.add(this._transformItems(this._source.get(e.items)))}_update(t,e){null!=e&&this._target.update(this._transformItems(this._source.get(e.items)))}_remove(t,e){null!=e&&this._target.remove(this._transformItems(e.oldData))}}class v{constructor(t){this._source=t,r.set(this,[])}filter(t){return s(this,r).push((e=>e.filter(t))),this}map(t){return s(this,r).push((e=>e.map(t))),this}flatMap(t){return s(this,r).push((e=>e.flatMap(t))),this}to(t){return new w(this._source,s(this,r),t)}}function b(t){return"string"==typeof t||"number"==typeof t}r=new WeakMap;class I{constructor(t){n.set(this,[]),o.set(this,null),h.set(this,null),this.delay=null,this.max=1/0,this.setOptions(t)}setOptions(t){t&&void 0!==t.delay&&(this.delay=t.delay),t&&void 0!==t.max&&(this.max=t.max),this._flushIfNeeded()}static extend(t,e){const s=new I(e);if(void 0!==t.flush)throw new Error("Target object already has a property flush");t.flush=()=>{s.flush()};const r=[{name:"flush",original:void 0}];if(e&&e.replace)for(let i=0;i<e.replace.length;i++){const n=e.replace[i];r.push({name:n,original:t[n]}),s.replace(t,n)}return i(s,h,{object:t,methods:r}),s}destroy(){if(this.flush(),s(this,h)){const t=s(this,h).object,e=s(this,h).methods;for(let s=0;s<e.length;s++){const i=e[s];i.original?t[i.name]=i.original:delete t[i.name]}i(this,h,null)}}replace(t,e){const s=this,i=t[e];if(!i)throw new Error("Method "+e+" undefined");t[e]=function(...t){s.queue({args:t,fn:i,context:this})}}queue(t){"function"==typeof t?s(this,n).push({fn:t}):s(this,n).push(t),this._flushIfNeeded()}_flushIfNeeded(){s(this,n).length>this.max&&this.flush(),null!=s(this,o)&&(clearTimeout(s(this,o)),i(this,o,null)),this.queue.length>0&&"number"==typeof this.delay&&i(this,o,setTimeout((()=>{this.flush()}),this.delay))}flush(){s(this,n).splice(0).forEach((t=>{t.fn.apply(t.context||t.fn,t.args||[])}))}}n=new WeakMap,o=new WeakMap,h=new WeakMap;class E{constructor(){l.set(this,{"*":[],add:[],remove:[],update:[]}),this.subscribe=E.prototype.on,this.unsubscribe=E.prototype.off}_trigger(t,e,i){if("*"===t)throw new Error("Cannot trigger event *");[...s(this,l)[t],...s(this,l)["*"]].forEach((s=>{s(t,e,null!=i?i:null)}))}on(t,e){"function"==typeof e&&s(this,l)[t].push(e)}off(t,e){s(this,l)[t]=s(this,l)[t].filter((t=>t!==e))}}l=new WeakMap;class k{constructor(t){a.set(this,void 0),i(this,a,t)}*[(a=new WeakMap,Symbol.iterator)](){for(const[t,e]of s(this,a))yield[t,e]}*entries(){for(const[t,e]of s(this,a))yield[t,e]}*keys(){for(const[t]of s(this,a))yield t}*values(){for(const[,t]of s(this,a))yield t}toIdArray(){return[...s(this,a)].map((t=>t[0]))}toItemArray(){return[...s(this,a)].map((t=>t[1]))}toEntryArray(){return[...s(this,a)]}toObjectMap(){const t=Object.create(null);for(const[e,i]of s(this,a))t[e]=i;return t}toMap(){return new Map(s(this,a))}toIdSet(){return new Set(this.toIdArray())}toItemSet(){return new Set(this.toItemArray())}cache(){return new k([...s(this,a)])}distinct(t){const e=new Set;for(const[i,r]of s(this,a))e.add(t(r,i));return e}filter(t){const e=s(this,a);return new k({*[Symbol.iterator](){for(const[s,i]of e)t(i,s)&&(yield[s,i])}})}forEach(t){for(const[e,i]of s(this,a))t(i,e)}map(t){const e=s(this,a);return new k({*[Symbol.iterator](){for(const[s,i]of e)yield[s,t(i,s)]}})}max(t){const e=s(this,a)[Symbol.iterator]();let i=e.next();if(i.done)return null;let r=i.value[1],n=t(i.value[1],i.value[0]);for(;!(i=e.next()).done;){const[e,s]=i.value,o=t(s,e);o>n&&(n=o,r=s)}return r}min(t){const e=s(this,a)[Symbol.iterator]();let i=e.next();if(i.done)return null;let r=i.value[1],n=t(i.value[1],i.value[0]);for(;!(i=e.next()).done;){const[e,s]=i.value,o=t(s,e);o<n&&(n=o,r=s)}return r}reduce(t,e){for(const[i,r]of s(this,a))e=t(e,r,i);return e}sort(t){return new k({[Symbol.iterator]:()=>[...s(this,a)].sort((([e,s],[i,r])=>t(s,r,e,i)))[Symbol.iterator]()})}}class D extends E{constructor(t,e){super(),u.set(this,void 0),f.set(this,void 0),d.set(this,void 0),c.set(this,null),t&&!Array.isArray(t)&&(e=t,t=[]),i(this,u,e||{}),i(this,f,new Map),this.length=0,i(this,d,s(this,u).fieldId||"id"),t&&t.length&&this.add(t),this.setOptions(e)}get idProp(){return s(this,d)}setOptions(t){t&&void 0!==t.queue&&(!1===t.queue?s(this,c)&&(s(this,c).destroy(),i(this,c,null)):(s(this,c)||i(this,c,I.extend(this,{replace:["add","update","remove"]})),t.queue&&"object"==typeof t.queue&&s(this,c).setOptions(t.queue)))}add(t,e){const i=[];let r;if(Array.isArray(t)){if(t.map((t=>t[s(this,d)])).some((t=>s(this,f).has(t))))throw new Error("A duplicate id was found in the parameter array.");for(let e=0,s=t.length;e<s;e++)r=this._addItem(t[e]),i.push(r)}else{if(!t||"object"!=typeof t)throw new Error("Unknown dataType");r=this._addItem(t),i.push(r)}return i.length&&this._trigger("add",{items:i},e),i}update(t,e){const i=[],r=[],n=[],o=[],h=s(this,d),l=t=>{const e=t[h];if(null!=e&&s(this,f).has(e)){const i=t,h=Object.assign({},s(this,f).get(e)),l=this._updateItem(i);r.push(l),o.push(i),n.push(h)}else{const e=this._addItem(t);i.push(e)}};if(Array.isArray(t))for(let e=0,s=t.length;e<s;e++)t[e]&&"object"==typeof t[e]?l(t[e]):console.warn("Ignoring input item, which is not an object at index "+e);else{if(!t||"object"!=typeof t)throw new Error("Unknown dataType");l(t)}if(i.length&&this._trigger("add",{items:i},e),r.length){const t={items:r,oldData:n,data:o};this._trigger("update",t,e)}return i.concat(r)}updateOnly(e,i){Array.isArray(e)||(e=[e]);const r=e.map((t=>{const e=s(this,f).get(t[s(this,d)]);if(null==e)throw new Error("Updating non-existent items is not allowed.");return{oldData:e,update:t}})).map((({oldData:e,update:i})=>{const r=e[s(this,d)],n=t(e,i);return s(this,f).set(r,n),{id:r,oldData:e,updatedData:n}}));if(r.length){const t={items:r.map((t=>t.id)),oldData:r.map((t=>t.oldData)),data:r.map((t=>t.updatedData))};return this._trigger("update",t,i),t.items}return[]}get(t,e){let i=void 0,r=void 0,n=void 0;b(t)?(i=t,n=e):Array.isArray(t)?(r=t,n=e):n=t;const o=n&&"Object"===n.returnType?"Object":"Array",h=n&&n.filter,l=[];let a=void 0,u=void 0,c=void 0;if(null!=i)a=s(this,f).get(i),a&&h&&!h(a)&&(a=void 0);else if(null!=r)for(let t=0,e=r.length;t<e;t++)a=s(this,f).get(r[t]),null==a||h&&!h(a)||l.push(a);else{u=[...s(this,f).keys()];for(let t=0,e=u.length;t<e;t++)c=u[t],a=s(this,f).get(c),null==a||h&&!h(a)||l.push(a)}if(n&&n.order&&null==i&&this._sort(l,n.order),n&&n.fields){const t=n.fields;if(null!=i&&null!=a)a=this._filterFields(a,t);else for(let e=0,s=l.length;e<s;e++)l[e]=this._filterFields(l[e],t)}if("Object"==o){const t={};for(let e=0,i=l.length;e<i;e++){const i=l[e];t[i[s(this,d)]]=i}return t}return null!=i?null!=a?a:null:l}getIds(t){const e=s(this,f),i=t&&t.filter,r=t&&t.order,n=[...e.keys()],o=[];if(i)if(r){const t=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],o=s(this,f).get(r);null!=o&&i(o)&&t.push(o)}this._sort(t,r);for(let e=0,i=t.length;e<i;e++)o.push(t[e][s(this,d)])}else for(let t=0,e=n.length;t<e;t++){const e=n[t],r=s(this,f).get(e);null!=r&&i(r)&&o.push(r[s(this,d)])}else if(r){const t=[];for(let s=0,i=n.length;s<i;s++){const i=n[s];t.push(e.get(i))}this._sort(t,r);for(let e=0,i=t.length;e<i;e++)o.push(t[e][s(this,d)])}else for(let t=0,i=n.length;t<i;t++){const i=n[t],r=e.get(i);null!=r&&o.push(r[s(this,d)])}return o}getDataSet(){return this}forEach(t,e){const i=e&&e.filter,r=[...s(this,f).keys()];if(e&&e.order){const i=this.get(e);for(let e=0,r=i.length;e<r;e++){const r=i[e];t(r,r[s(this,d)])}}else for(let e=0,n=r.length;e<n;e++){const n=r[e],o=s(this,f).get(n);null==o||i&&!i(o)||t(o,n)}}map(t,e){const i=e&&e.filter,r=[],n=[...s(this,f).keys()];for(let e=0,o=n.length;e<o;e++){const o=n[e],h=s(this,f).get(o);null==h||i&&!i(h)||r.push(t(h,o))}return e&&e.order&&this._sort(r,e.order),r}_filterFields(t,e){return t?(Array.isArray(e)?e:Object.keys(e)).reduce(((e,s)=>(e[s]=t[s],e)),{}):t}_sort(t,e){if("string"==typeof e){const s=e;t.sort(((t,e)=>{const i=t[s],r=e[s];return i>r?1:i<r?-1:0}))}else{if("function"!=typeof e)throw new TypeError("Order must be a function or a string");t.sort(e)}}remove(t,e){const i=[],r=[],n=Array.isArray(t)?t:[t];for(let t=0,e=n.length;t<e;t++){const e=this._remove(n[t]);if(e){const t=e[s(this,d)];null!=t&&(i.push(t),r.push(e))}}return i.length&&this._trigger("remove",{items:i,oldData:r},e),i}_remove(t){let e;if(b(t)?e=t:t&&"object"==typeof t&&(e=t[s(this,d)]),null!=e&&s(this,f).has(e)){const t=s(this,f).get(e)||null;return s(this,f).delete(e),--this.length,t}return null}clear(t){const e=[...s(this,f).keys()],i=[];for(let t=0,r=e.length;t<r;t++)i.push(s(this,f).get(e[t]));return s(this,f).clear(),this.length=0,this._trigger("remove",{items:e,oldData:i},t),e}max(t){let e=null,i=null;for(const r of s(this,f).values()){const s=r[t];"number"==typeof s&&(null==i||s>i)&&(e=r,i=s)}return e||null}min(t){let e=null,i=null;for(const r of s(this,f).values()){const s=r[t];"number"==typeof s&&(null==i||s<i)&&(e=r,i=s)}return e||null}distinct(t){const e=s(this,f),i=[...e.keys()],r=[];let n=0;for(let s=0,o=i.length;s<o;s++){const o=i[s],h=e.get(o)[t];let l=!1;for(let t=0;t<n;t++)if(r[t]==h){l=!0;break}l||void 0===h||(r[n]=h,n++)}return r}_addItem(t){const i=function(t,s){return null==t[s]&&(t[s]=e()),t}(t,s(this,d)),r=i[s(this,d)];if(s(this,f).has(r))throw new Error("Cannot add item: item with id "+r+" already exists");return s(this,f).set(r,i),++this.length,r}_updateItem(t){const e=t[s(this,d)];if(null==e)throw new Error("Cannot update item: item has no id (item: "+JSON.stringify(t)+")");const i=s(this,f).get(e);if(!i)throw new Error("Cannot update item: no item with id "+e+" found");return s(this,f).set(e,{...i,...t}),e}stream(t){if(t){const e=s(this,f);return new k({*[Symbol.iterator](){for(const s of t){const t=e.get(s);null!=t&&(yield[s,t])}}})}return new k({[Symbol.iterator]:s(this,f).entries.bind(s(this,f))})}}u=new WeakMap,f=new WeakMap,d=new WeakMap,c=new WeakMap;class x extends E{constructor(t,e){super(),this.length=0,p.set(this,void 0),g.set(this,void 0),m.set(this,new Set),y.set(this,void 0),i(this,y,e||{}),i(this,p,this._onEvent.bind(this)),this.setData(t)}get idProp(){return this.getDataSet().idProp}setData(t){if(s(this,g)){s(this,g).off&&s(this,g).off("*",s(this,p));const t=s(this,g).getIds({filter:s(this,y).filter}),e=s(this,g).get(t);s(this,m).clear(),this.length=0,this._trigger("remove",{items:t,oldData:e})}if(null!=t){i(this,g,t);const e=s(this,g).getIds({filter:s(this,y).filter});for(let t=0,i=e.length;t<i;t++){const i=e[t];s(this,m).add(i)}this.length=e.length,this._trigger("add",{items:e})}else i(this,g,new D);s(this,g).on&&s(this,g).on("*",s(this,p))}refresh(){const t=s(this,g).getIds({filter:s(this,y).filter}),e=[...s(this,m)],i={},r=[],n=[],o=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];i[n]=!0,s(this,m).has(n)||(r.push(n),s(this,m).add(n))}for(let t=0,r=e.length;t<r;t++){const r=e[t],h=s(this,g).get(r);null==h?console.error("If you see this, report it please."):i[r]||(n.push(r),o.push(h),s(this,m).delete(r))}this.length+=r.length-n.length,r.length&&this._trigger("add",{items:r}),n.length&&this._trigger("remove",{items:n,oldData:o})}get(t,e){if(null==s(this,g))return null;let i,r=null;b(t)||Array.isArray(t)?(r=t,i=e):i=t;const n=Object.assign({},s(this,y),i),o=s(this,y).filter,h=i&&i.filter;return o&&h&&(n.filter=t=>o(t)&&h(t)),null==r?s(this,g).get(n):s(this,g).get(r,n)}getIds(t){if(s(this,g).length){const e=s(this,y).filter,i=null!=t?t.filter:null;let r;return r=i?e?t=>e(t)&&i(t):i:e,s(this,g).getIds({filter:r,order:t&&t.order})}return[]}forEach(t,e){if(s(this,g)){const i=s(this,y).filter,r=e&&e.filter;let n;n=r?i?function(t){return i(t)&&r(t)}:r:i,s(this,g).forEach(t,{filter:n,order:e&&e.order})}}map(t,e){if(s(this,g)){const i=s(this,y).filter,r=e&&e.filter;let n;return n=r?i?t=>i(t)&&r(t):r:i,s(this,g).map(t,{filter:n,order:e&&e.order})}return[]}getDataSet(){return s(this,g).getDataSet()}stream(t){return s(this,g).stream(t||{[Symbol.iterator]:s(this,m).keys.bind(s(this,m))})}dispose(){var t;(null===(t=s(this,g))||void 0===t?void 0:t.off)&&s(this,g).off("*",s(this,p));const e="This data view has already been disposed of.",i={get:()=>{throw new Error(e)},set:()=>{throw new Error(e)},configurable:!1};for(const t of Reflect.ownKeys(x.prototype))Object.defineProperty(this,t,i)}_onEvent(t,e,i){if(!e||!e.items||!s(this,g))return;const r=e.items,n=[],o=[],h=[],l=[],a=[],u=[];switch(t){case"add":for(let t=0,e=r.length;t<e;t++){const e=r[t];this.get(e)&&(s(this,m).add(e),n.push(e))}break;case"update":for(let t=0,i=r.length;t<i;t++){const i=r[t];this.get(i)?s(this,m).has(i)?(o.push(i),a.push(e.data[t]),l.push(e.oldData[t])):(s(this,m).add(i),n.push(i)):s(this,m).has(i)&&(s(this,m).delete(i),h.push(i),u.push(e.oldData[t]))}break;case"remove":for(let t=0,i=r.length;t<i;t++){const i=r[t];s(this,m).has(i)&&(s(this,m).delete(i),h.push(i),u.push(e.oldData[t]))}}this.length+=n.length-h.length,n.length&&this._trigger("add",{items:n},i),o.length&&this._trigger("update",{items:o,oldData:l,data:a},i),h.length&&this._trigger("remove",{items:h,oldData:u},i)}}function S(t,e){return"object"==typeof e&&null!==e&&t===e.idProp&&"function"==typeof e.add&&"function"==typeof e.clear&&"function"==typeof e.distinct&&"function"==typeof e.forEach&&"function"==typeof e.get&&"function"==typeof e.getDataSet&&"function"==typeof e.getIds&&"number"==typeof e.length&&"function"==typeof e.map&&"function"==typeof e.max&&"function"==typeof e.min&&"function"==typeof e.off&&"function"==typeof e.on&&"function"==typeof e.remove&&"function"==typeof e.setOptions&&"function"==typeof e.stream&&"function"==typeof e.update&&"function"==typeof e.updateOnly}function A(t,e){return"object"==typeof e&&null!==e&&t===e.idProp&&"function"==typeof e.forEach&&"function"==typeof e.get&&"function"==typeof e.getDataSet&&"function"==typeof e.getIds&&"number"==typeof e.length&&"function"==typeof e.map&&"function"==typeof e.off&&"function"==typeof e.on&&"function"==typeof e.stream&&S(t,e.getDataSet())}p=new WeakMap,g=new WeakMap,m=new WeakMap,y=new WeakMap;export{D as DataSet,k as DataStream,x as DataView,I as Queue,_ as createNewDataPipeFrom,S as isDataSetLike,A as isDataViewLike};
//# sourceMappingURL=vis-data.min.js.map
